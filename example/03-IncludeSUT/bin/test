#!/bin/sh

# Get directory containing this script
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Create a temporary directory
temp_directory=$(mktemp -d "${TMPDIR:-/tmp/}$(basename $0).XXXXXXXXXXXX")
echo "Temp Directory: ${temp_directory}"

# Create a python virtual environment
virtualenv "${temp_directory}/local"
"${temp_directory}/local/bin/pip" install robotframework

# Run tests
args="$@"
bash -c "printf "\""\
export PATH="${temp_directory}/local/bin":/bin:/usr/bin:/usr/local/bin\\n\
"${temp_directory}/local/bin/robot" -d "${DIR}/../results" "${DIR}/../src/SUT.robot"\\n\
"\" > "${temp_directory}/test.sh"
chmod +x "${temp_directory}/test.sh"
env -i "${temp_directory}/test.sh"

# Clean Up
rm -fr "${temp_directory}"
